<!doctype html> <html lang=en> <head> <meta charset=utf-8> <link rel=stylesheet href='/css/250adbc.css'> <title>The Power of Git | David Nadlinger</title> <meta name=viewport content="width=device-width; initial-scale=1.0"> <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script> <link rel="openid.server" href="http://openid.klickverbot.at/"/> <link rel="openid2.provider" href="http://openid.klickverbot.at/"/> </head> <body> <header id=main_header> <h1><span><a href="/">David Nadlinger</a></span></h1> <nav role=navigation> <ul> <li><a href="/blog">Blog</a></li> <li><a href="/code">Code</a></li> <li><a href="/about">About</a></li> </ul> </nav> </header> <div role=main id=main_content> <article class=blog-post> <header> <h1><a href="/blog/2009/07/the-power-of-git/">The Power of Git</a></h1> <section class=metadata> on <time datetime="2009-07-28T00:00:00+01:00">28 Jul 2009</time> </section> <ul class=pagenav> <li><a href="/blog/2009/07/installing-dmd-ldc-tango-and-dsss-on-kubuntu-jaunty/">Older</a></li> <li><a href="/blog/2009/10/setting-up-gdc-and-tango-on-linux-x86/">Newer</a></li> </ul> </header> <div class=content> <p>As you might already know if you read my <a href="/blog/2008/08/getting-started-with-git/">blog post</a> about it, I have been using Git quite a while ago now. However, I am still amazed not infrequently by the fact that Git <em>simply works</em>, in the sense that it really does the things you tell it to do.</p> <p>Recently, for instance, I wanted to merge an extension to the great <a href="http://assimp.sf.net">Open Asset Import Library</a> (bindings for the <a href="http://www.digitalmars.com/d/">D programming language</a>, in fact) which I developed locally in Git to the upstream repository in a way that the commit history was kept locally. However, <span class=caps>SVN</span> is used as <span class=caps>SCM</span> system for upstream development. So I started out by importing the upstream <span class=caps>SVN</span> repository via <code>git-svn</code>:</p> <figure class=code> <div class=highlight><pre><span class="nv">$ </span>mkdir assimp<span class="p">;</span> <span class="nb">cd </span>assimp<br />
<span class="nv">$ </span>git svn init https://assimp.svn.sourceforge.net/svnroot/assimp/trunk<br />
<span class="nv">$ </span>git svn fetch<br />
</pre></div></figure> <p>Nothing too exciting here. So far, I only created a local Git clone of the <span class=caps>SVN</span> repository which I probably will use for contributing to upstream development in the future. But how to transfer the bindings from the Git repository to this one <em>including</em> their (strictly linear, i.e. master-only) commit history? Because Git does not try to be smarter than its users, the first solution I came up with worked flawlessly. Here is what I did:</p> <figure class=code> <div class=highlight><pre><span class="nv">$ </span>git checkout -b d-bindings<br />
<span class="nv">$ </span>git fetch ../dAssimp<br />
<span class="nv">$ </span>git <span class="nb">read</span>-tree &#8212;prefix<span class="o">=</span>port/dAssimp FETCH_HEAD<br />
<span class="nv">$ </span>git rev-parse FETCH_HEAD &gt; .git/MERGE_HEAD<br />
<span class="nv">$ </span>git commit<br />
</pre></div></figure> <p>After switching to a new branch in which the history should be stored, I told Git to fetch the contents of the local <code>dAssimp</code> repository (the D bindings I developed). Because I had not made any merges, Git simply stored the <code>HEAD</code> of the other repository in <code>FETCH_HEAD</code>. The <code>read-tree</code> command reads, as the name suggests, arbitrary tree information into the index. The <code>--prefix</code> switch allows you to keep the current index and read the tree into an (empty) subdirectory instead – perfect for what I intended to do. Storing the <code>FETCH_HEAD</code>&#8216;s object name into <code>.git/MERGE_HEAD</code> tells Git to generate a merge commit the next time <code>git commit</code> is called. There was just one last thing left to do: as <code>git read-tree</code>, according to the manpage, »does not actually update any of the files it ›caches‹«, a <code>git reset --hard</code> is needed to actually create the new files in the working copy. That&#8217;s it.</p> <p>As I found out later, I could have possibly done this more easy using the <a href="http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html">subtree merge strategy</a>, but I still like, as mentioned above, Git&#8217;s feature of »just doing what you tell it to do«…</p> <footer> Like what you read? <a href="http://twitter.com/?status=@dnadlinger:">Let me know</a> what you think or <a href="http://twitter.com/?status=Just read »The Power of Git« by @dnadlinger: http://klickverbot.at/blog/2009/07/the-power-of-git/">share the article</a> on Twitter. Also, there is more on <a href="/blog/tags/Git/" title="View all posts tagged with »Git«" rel=tag>Git</a>. </footer> </div> </article> </div> <footer id=main_footer> <ul> <li><a class=twitter href="//twitter.com/dnadlinger">Follow me on Twitter</a></li> <li><a class=mail href="/about">Contact me</a></li> <li><a class=rss href="/blog/atom.xml">Blog feed</a></li> </ul> </footer> </body> </html>