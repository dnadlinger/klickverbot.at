<!doctype html> <html lang=en> <head> <meta charset=utf-8> <link rel=stylesheet href='/css/250adbc.css'> <title>D/Thrift GSoC: Growing the library | David Nadlinger</title> <meta name=viewport content="width=device-width; initial-scale=1.0"> <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script> <link rel="openid.server" href="http://openid.klickverbot.at/"/> <link rel="openid2.provider" href="http://openid.klickverbot.at/"/> </head> <body> <header id=main_header> <h1><span><a href="/">David Nadlinger</a></span></h1> <nav role=navigation> <ul> <li><a href="/blog">Blog</a></li> <li><a href="/code">Code</a></li> <li><a href="/about">About</a></li> </ul> </nav> </header> <div role=main id=main_content> <article class=blog-post> <header> <h1><a href="/blog/2011/06/d-thrift-gsoc-growing-the-library/">D/Thrift GSoC: Growing the library</a></h1> <section class=metadata> on <time datetime="2011-06-14T00:00:00-04:00">14 Jun 2011</time> </section> <ul class=pagenav> <li><a href="/blog/2011/05/d-thrift-gsoc-first-results/">Older</a></li> <li><a href="/blog/2011/06/d-thrift-gsoc-protocols-compact-json-performance/">Newer</a></li> </ul> </header> <div class=content> <p>First, let me apologize for not posting an update last week – I had a busy time, but regardless I will try to let you know about the state of affairs regularly in the future. Now, what were I working on? I updated my <a href="/code/gsoc/thrift/">project page</a> based on the timeline previously discussed at my project mailing list, and – besides me being a day late, more below – it is still valid. These were the main points I worked on:</p> <ul> <li> <p><em>Build system integration</em>: The D library is now integrated with the Thrift Autoconf/Automake build system. If a working D2 compiler is detected, the <code>libthriftd</code> static library containing all the modules is now built on issuing <code>make</code> along with the rest of Thrift. <code>make check</code> runs the unit tests for each D module and builds the standalone test executables (i.e. <code>ThriftTest</code> for now).</p> </li> <li> <p><em>Socket transport enhancements</em>: Implemented <code>interrupt()</code> for the server socket which can be used to notify a server waiting on a blocking socket for connections about shutdown, added socket timeouts, properly handle exceptions thrown by <code>std.socket</code>, …</p> </li> <li> <p>Added a D implementation of <em><code>TMemoryBuffer</code></em>, which is widely internally used and a nice tool for writing unit tests as well. Implemented the <em>Framed</em> transport in D.</p> </li> <li> <p>Implemented <em><code>TFileReaderTransport</code></em> and <em><code>TFileWriterTransport</code></em>, the D equivalent to the C++ <code>TFileTransport</code>. I separated the two components because I could not really think of a situation in which you would use both at once, and conflating the two would complicate the state space (I am not even sure if the C++ implementation does what it is supposed to if read/write calls are interleaved) and make the implementation unnecessarily complex. The <code>TFileWriterTransport</code> implementation performs the actual file I/O in a separate worker thread, which communicates with the main thread using a message passing approach (leveraging D’s <code>std.concurrency</code> module).</p> </li> <li> <p>A simple <em>HTTP client/server transport</em>, closely modeled after the C++ implementation.</p> </li> <li> <p>An <em>SSL client/server socket</em> implementation using the OpenSSL library, which is linked in dynamically (primarily for easy Windows compatibility). The actual implementation is pretty much a direct port of the C++ <code>TSSLSocket</code>, but I had to quickly write the D2 bindings for OpenSSL first. For now, the bindings live in <code>thrift.util.openssl</code>, as I only included the subset of functions I needed for Thrift, but I might move them out in the future.</p> </li> </ul> <p>As always, you can find the changes <a href="https://github.com/dnadlinger/thrift">on my GitHub fork</a>. I also spent a sizable chunk of my time on contributing some improvements and fixed to the D compiler and standard library projects. As for the issues I mentioned two weeks ago, kudos to Don Clugston for promptly fixing CTFE issues <a href="http://d.puremagic.com/issues/show_bug.cgi?id=6077">6077</a> and <a href="http://d.puremagic.com/issues/show_bug.cgi?id=6078">6078</a>, and my <a href="https://github.com/D-Programming-Language/dmd/pull/77">DMD pull request 77</a> and <a href="https://github.com/D-Programming-Language/phobos/pull/65">Phobos pull request 65</a> were also merged in the meantime.</p> <p>During the last two weeks, I worked on Phobos pull requests <a href="https://github.com/D-Programming-Language/phobos/pull/73">73</a> (adds <code>std.socket.socketpair</code>), <a href="https://github.com/D-Programming-Language/phobos/pull/87">87</a> (better <code>std.file</code> error messages), <a href="https://github.com/D-Programming-Language/phobos/pull/90">90</a> (fixes a mailbox handling bug in <code>std.concurrency</code> – took me quite some time to track down as it caused sporadic deadlocks in my unit tests), <a href="https://github.com/D-Programming-Language/phobos/pull/99">99</a> (adds timeout handling and hostname lookup to <code>std.socket</code> – I still don’t know why WinSock adds 500 ms to the <code>recv()</code> timeout), <a href="https://github.com/D-Programming-Language/druntime/pull/28">druntime pull request 28</a> (adds a Posix <code>netdb.h</code> module) and <a href="https://github.com/D-Programming-Language/dmd/pull/118">DMD pull request 118</a> (finally removes the <code>_DH</code> flag).</p> <p>Furthermore, I collaborated with Daniel Murphy on fixing the long-standing issue that function pointers are not properly typechecked, resulting in <a href="https://github.com/D-Programming-Language/dmd/pull/96">DMD pull request 96</a> and [druntime pull request 26] (https://github.com/D-Programming-Language/druntime/pull/26). I have also started to work the dreaded DMD <a href="http://d.puremagic.com/issues/show_bug.cgi?id=314">bug 314</a>. While the basic fix is in place – that’s how I found the bug in <a href="https://github.com/D-Programming-Language/phobos/pull/102">Phobos pull request 102</a> – (I adapted the D1/LDC changes by Christian Kamm to D2/DMD), I still need to add some more tests and solve a few more complex cases. Unfortunately, I also hit two new issues which I have not been able to fix yet: <a href="http://d.puremagic.com/issues/show_bug.cgi?id=6108">6108</a>, a DMD contract inheritance bug, and <a href="http://d.puremagic.com/issues/show_bug.cgi?id=6135">6135</a>, a druntime OSX threading/GC crash.</p> <footer> Like what you read? <a href="http://twitter.com/?status=@dnadlinger:">Let me know</a> what you think or <a href="http://twitter.com/?status=Just read »D/Thrift GSoC: Growing the library« by @dnadlinger: http://klickverbot.at/blog/2011/06/d-thrift-gsoc-growing-the-library/">share the article</a> on Twitter. Also, there is more on <a href="/blog/tags/D/" title="View all posts tagged with »D«" rel=tag>D</a>, <a href="/blog/tags/GSoC/" title="View all posts tagged with »GSoC«" rel=tag>GSoC</a> and <a href="/blog/tags/Thrift/" title="View all posts tagged with »Thrift«" rel=tag>Thrift</a>. </footer> </div> </article> </div> <footer id=main_footer> <ul> <li><a class=twitter href="//twitter.com/dnadlinger">Follow me on Twitter</a></li> <li><a class=mail href="/about">Contact me</a></li> <li><a class=rss href="/blog/atom.xml">Blog feed</a></li> </ul> </footer> </body> </html>